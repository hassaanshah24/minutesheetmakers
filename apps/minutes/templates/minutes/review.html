{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4">Review Minute: {{ minute.unique_id }}</h1>

    <h3>{{ minute.title }}</h3>
    <p>{{ minute.description }}</p>

    <h5>Approval Chain</h5>
    <ul>
        {% for step in all_steps %}
            <li>
                <strong>Step {{ step.step_order }}:</strong> {{ step.approver.get_full_name }}
                {% if step.status == "approved" %}
                    (Approved at {{ step.approved_at|date:"Y-m-d H:i" }})
                {% elif step.status == "rejected" %}
                    (Rejected)
                {% else %}
                    (Pending)
                {% endif %}
            </li>
        {% endfor %}
    </ul>

    <form method="post">
        {% csrf_token %}
        <input type="hidden" name="comments" value="">

        <div class="form-group">
            <label for="action">Action</label>
            <select name="action" id="action" class="form-control">
                <option value="approve">Approve</option>
                <option value="reject">Reject</option>
                <option value="mark_to">Mark To</option>
                <option value="return_to">Return To</option>
            </select>
        </div>

        <div id="extra-fields" class="mt-3">
            <!-- Additional fields for Mark To and Return To actions -->
            <div id="mark-to-field" class="d-none">
                <label for="mark_to_user">Select User to Mark To</label>
                <select name="mark_to_user" id="mark_to_user" class="form-control">
                    {% for approver in approvers %}
                        <option value="{{ approver.id }}">{{ approver.get_full_name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div id="return-to-field" class="d-none">
                <label for="return_to_step">Select Step to Return To</label>
                <select name="return_to_step" id="return_to_step" class="form-control">
                    {% for step in all_steps %}
                        <option value="{{ step.step_order }}">Step {{ step.step_order }} - {{ step.approver.get_full_name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <button type="submit" class="btn btn-primary mt-4">Submit</button>
    </form>
</div>

<script>
    document.getElementById("action").addEventListener("change", function() {
        const action = this.value;
        document.getElementById("mark-to-field").classList.toggle("d-none", action !== "mark_to");
        document.getElementById("return-to-field").classList.toggle("d-none", action !== "return_to");
    });
</script>
{% endblock %}
